!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["BdVideoBox.js"]=t():n["BdVideoBox.js"]=t()}(this,function(){return function(n){function t(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return n[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var e={};return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:o})},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=0)}([function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={ua:navigator.userAgent,isBox:/ baiduboxapp\//i.test(this.ua)&&!/ lite baiduboxapp/.test(this.ua),isBoxFunc:function(){var n=window.navigator||{},t=n.userAgent;return/ baiduboxapp\//i.test(t)&&!/ lite baiduboxapp/.test(t)},isLiteBox:/ lite baiduboxapp\//i.test(this.ua),isLiteBoxFunc:function(){return/ lite baiduboxapp\//i.test((window.navigator||{}).userAgent)},isIOS:/(iPhone|iPod|iPad)/.test(this.ua),isIOSFunc:function(){return/(iPhone|iPod|iPad)/.test((window.navigator||{}).userAgent)},isAndroid:/(Android);?[\s\/]+([\d.]+)?/.test(this.ua),isAndroidFunc:function(){return/(Android);?[\s\/]+([\d.]+)?/.test((window.navigator||{}).userAgent)}},i={source:"",flag:"",connectInterval:null,CONNECT_CHECK_TIME:1e3,CHECK_COUNT:10,connect:function(n,t){if(n.flag&&n.source){var e=0;i.flag=n.flag||"",i.source=n.source||"",window.addEventListener("message",function(n){var t=n.data||{};t.flag===i.flag&&t.actionType===l.Const.ACTION_TYPE.CONNECT&&t.status===l.Const.MSG_STATUS.OK&&i.connectInterval&&window.clearInterval(i.connectInterval)}),i.connectInterval&&window.clearInterval(i.connectInterval),i.connectInterval=window.setInterval(function(){if(e>i.CHECK_COUNT&&i.connectInterval&&window.clearInterval(i.connectInterval),l.MsgUtil&&l.MsgUtil.isSupportedPostMsg()){var t={msgId:l.MsgUtil.getMsgId(),flag:n.flag||"",source:n.source||"",actionType:l.Const.ACTION_TYPE.CONNECT,actionParams:n||{}};delete n.flag,delete n.source,top !== self && window.parent.postMessage(t,"*")}e++},i.CONNECT_CHECK_TIME)}},setVideoInfo:function(n){l.MsgUtil.postMsgToParent(l.Const.ACTION_TYPE.SET_VIDEOINFO,n)},openApp:function(n){l.MsgUtil.postMsgToParent(l.Const.ACTION_TYPE.OPEN_APP,n)},openLink:function(n){l.MsgUtil.postMsgToParent(l.Const.ACTION_TYPE.OPEN_LINK,n)}},s=i,a={getMsgId:function(){return s.source+ +new Date+""+Math.round(1e3*Math.random())},isSupportedPostMsg:function(){return window.parent&&window.parent.postMessage},postMsgToParent:function(n,t){if(s.flag&&s.source&&a.isSupportedPostMsg()){var e={msgId:t.msgId||"",flag:s.flag||"",source:s.source||"",actionType:n||"",actionParams:t||{}};top !== self && window.parent.postMessage(e,"*")}}},r=a,c={ACTION_TYPE:{CONNECT:"connect",SET_VIDEOINFO:"setVideoInfo",SET_PAGESTYLE:"setPageStyle",SET_FONTSIZE:"setFontSize",OPEN_APP:"openApp",OPEN_LINK:"openLink"},MSG_STATUS:{OK:"OK",ERROR:"error"}},l={CommonUtil:o,MsgUtil:r,Const:c},u={firePool:{},listenPool:{},syncListenPool:{},fire:function(n,t){var e=[];u.firePool[n]=u.firePool[n]||[],u.firePool[n].push(t);var o=u.listenPool[n];if(o){for(var i=0,s=o.length;i<s;i++){var a=o[i],r=a.callback&&a.callback.call({event:n},t);r&&e.push(r),o[i].once&&(o=null)}return e}return null},listen:function(n,t,e){"string"==typeof n&&(n=[n]),e=e||{};for(var o=0;o<n.length;o++){var i=n[o];u.listenPool[i]=u.listenPool[i]||[],u.listenPool[i].push({once:e.once,callback:t})}},unlisten:function(n){for(var t=u.listenPool[n]||[],e=0;e<t.length&&t[e]!==n;e++)u.listenPool[n].slice(e,1)},syncActionListen:function(n,t,e){u.syncListenPool[n]=u.syncListenPool[n]||{},u.syncListenPool[n][t.msgId]=e},syncActionFire:function(n,t){var e=u.syncListenPool[n],o=e&&e[t.msgId];o&&(o(t),delete e[t.msgId])}},d=u,f={setPageStyle:function(n){l.MsgUtil.postMsgToParent("setPageStyle",n)}},p=f,g={init:function(){window.addEventListener("message",function(n){var t=n.data||{};if(t.flag===s.flag&&t.source===s.source){switch(t.actionType){case l.Const.ACTION_TYPE.SET_FONTSIZE:d.fire("onFontChange",t.backParams||{});break;case l.Const.ACTION_TYPE.CONNECT:d.fire("onConnect",t.backParams||{},{once:!0});break;case"onNeedChangePlayStatus":d.fire("onNeedChangePlayStatus",t.backParams||{})}g._isActionSupportSyncCallBack(t.actionType)&&d.syncActionFire(t.actionType,t||{})}})},_isActionSupportSyncCallBack:function(n){return{}[n]||!1},invoke:function(n,t,e){var o=l.MsgUtil.getMsgId();switch(t=t||{},t.msgId=o,n){case l.Const.ACTION_TYPE.CONNECT:s.connect(t);break;case l.Const.ACTION_TYPE.SET_PAGESTYLE:p.setPageStyle(t);break;case l.Const.ACTION_TYPE.SET_VIDEOINFO:s.setVideoInfo(t);break;case l.Const.ACTION_TYPE.OPEN_APP:s.openApp(t);break;case l.Const.ACTION_TYPE.OPEN_LINK:s.openLink(t)}g._isActionSupportSyncCallBack(n)&&d.syncActionListen(n,t,e)}},P=g;e.d(t,"invoke",function(){return T}),e.d(t,"Event",function(){return d}),e.d(t,"Utils",function(){return l});var T=P.invoke,C={version:"1.0.0",Event:d,Utils:l,invoke:T};P.init(),window.BdVideoBox=C;t.default=C}])});
